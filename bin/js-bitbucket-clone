#!/usr/bin/env bash

set -e

REPO="${1}"
INTO_DIR="${HOME}/repos"

REPO_CLEAN=$(echo "${REPO}" | xargs | sed -e "s/^git clone //" -e "s/$//")  # :cry: @ "git clone" prefix
REPO_URI_SEGMENT=$(echo "${REPO_CLEAN}" | sed -e "s/^git@bitbucket.org://" -e "s/$//" | sed -e 's/\(\.git\)*$//g')
REPO_PATH="${INTO_DIR}/bitbucket.org/${REPO_URI_SEGMENT}"

echo "INFO: Cloning '${REPO_CLEAN}' into '${REPO_PATH}'"

# Git clone
if [[ ! -d "${REPO_PATH}" ]] ; then
  git clone "${REPO_CLEAN}" "${REPO_PATH}"
else
  echo "WARNING: Directory already exists, skipping clone"
fi

# Open in IDE
read -r -p "Open in IDE? :" IDE_OPEN
if [[ "${IDE_OPEN}" -eq "TRUE" ]] ; then
  (cd "${REPO_PATH}" && idea . &)
fi
